import{u as G,p as J,r as l,g as K,d as A,b as p,a as C,t as Q,v as X,j as e,C as Z,x as I}from"./index-BZ3unhuO.js";import{s as ee}from"./supabaseClient-q4LZ2LF1.js";import{u as se,T as re}from"./Toast-BAYHie_W.js";import{M as ae}from"./Modal-BvfMSsbR.js";/* empty css              */const de=()=>{const y=G(),{isAdmin:d,loading:j}=J(),{toasts:w,success:S,error:i,removeToast:E}=se(),[c,L]=l.useState([]),[g,D]=l.useState([]),[M,U]=l.useState(!0),[f,R]=l.useState(""),[v,T]=l.useState("all"),[r,m]=l.useState(null),[F,u]=l.useState(!1),[P,h]=l.useState(!1),[t,b]=l.useState({role:"",enrolled_programs:[]}),[_,W]=l.useState("user");l.useEffect(()=>{!j&&!d&&(i("Access denied. Admin privileges required."),y("/"))},[d,j,y]),l.useEffect(()=>{d&&(x(),z(),$())},[d]);const $=async()=>{try{const s=await K(A(p,"users",C.currentUser.uid));s.exists()&&W(s.data().role||"user")}catch(s){console.error("Error fetching current user role:",s)}},z=async()=>{try{const{data:s,error:a}=await ee.from("programs").select("id, title");if(a)throw a;D(s||[])}catch(s){console.error("Error fetching programs:",s),i("Failed to fetch programs list.")}},x=async()=>{U(!0);try{const s=Q(p,"users"),n=(await X(s)).docs.map(o=>({id:o.id,...o.data(),createdAt:o.data().createdAt?.toDate?.()||new Date,enrolled_programs:o.data().enrolled_programs||[]}));n.sort((o,Y)=>Y.createdAt-o.createdAt),L(n)}catch(s){console.error("Error fetching users:",s),i("Failed to fetch users.")}finally{U(!1)}},B=async()=>{if(r)try{if(r.id===C.currentUser?.uid){i("You cannot delete your own account from here."),u(!1);return}await Z(A(p,"users",r.id)),S(`User ${r.name||r.email} has been deleted.`),u(!1),m(null),x()}catch(s){console.error("Error deleting user:",s),i("Failed to delete user.")}},H=async()=>{if(r){if(t.role!==r.role&&_!=="super_admin"){i("Only Super Admins can change user roles.");return}try{const s=A(p,"users",r.id);await I(s,{role:t.role,enrolled_programs:t.enrolled_programs,hasAccess:t.enrolled_programs.length>0}),S(`User ${r.name||r.email} has been updated.`),h(!1),m(null),x()}catch(s){console.error("Error updating user:",s),i("Failed to update user.")}}},q=s=>{m(s),b({role:s.role||"user",enrolled_programs:s.enrolled_programs||[]}),h(!0)},O=s=>{m(s),u(!0)},V=s=>{b(a=>{const n=a.enrolled_programs;return n.includes(s)?{...a,enrolled_programs:n.filter(o=>o!==s)}:{...a,enrolled_programs:[...n,s]}})},k=c.filter(s=>{const a=s.name?.toLowerCase().includes(f.toLowerCase())||s.email?.toLowerCase().includes(f.toLowerCase()),n=v==="all"||s.role===v;return a&&n});if(j)return e.jsx("div",{className:"admin-users-page",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading..."})]})});if(!d)return null;const N=_==="super_admin";return e.jsxs("div",{className:"admin-users-page",children:[w.map(s=>e.jsx(re,{message:s.message,type:s.type,onClose:()=>E(s.id)},s.id)),F&&e.jsx(ae,{title:"Delete User",message:`Are you sure you want to delete ${r?.name||r?.email}? This action cannot be undone.`,onConfirm:B,onCancel:()=>u(!1),confirmText:"Delete",type:"confirm"}),P&&e.jsx("div",{className:"modal-overlay",onClick:()=>h(!1),children:e.jsxs("div",{className:"modal-content edit-user-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Edit User"}),e.jsx("button",{className:"modal-close",onClick:()=>h(!1),children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{className:"form-group",children:e.jsxs("label",{children:["User: ",r?.name||r?.email]})}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"role",children:["Role ",!N&&e.jsx("span",{style:{color:"#ff6b6b",fontSize:"0.85em"},children:"(Super Admin only)"})]}),e.jsxs("select",{id:"role",value:t.role,onChange:s=>b({...t,role:s.target.value}),disabled:!N,children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Course Access"}),t.role==="admin"||t.role==="super_admin"?e.jsxs("div",{className:"alert-info",style:{padding:"10px",background:"rgba(99, 102, 241, 0.1)",borderRadius:"8px",border:"1px solid rgba(99, 102, 241, 0.2)",color:"#a5b4fc"},children:[e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",width:"16",height:"16",style:{marginRight:"8px",verticalAlign:"middle"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})," ",e.jsx("strong",{children:t.role==="super_admin"?"Super Admins":"Admins"})," automatically have access to all courses."]}):e.jsx("div",{className:"course-checkbox-list",children:g.length===0?e.jsx("p",{className:"text-muted",children:"No programs available."}):g.map(s=>e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:t.enrolled_programs.includes(s.id),onChange:()=>V(s.id)}),e.jsx("span",{children:s.title})]},s.id))})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>h(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:H,children:"Save Changes"})]})]})}),e.jsxs("div",{className:"admin-users-container",children:[e.jsxs("div",{className:"admin-users-header",children:[e.jsx("h1",{children:"User Management"}),e.jsxs("p",{children:["Manage all users, their roles, and access permissions",N?" (Super Admin)":" (Admin)"]})]}),e.jsxs("div",{className:"admin-controls",children:[e.jsx("div",{className:"search-box",children:e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:f,onChange:s=>R(s.target.value)})}),e.jsx("div",{className:"filter-box",children:e.jsxs("select",{value:v,onChange:s=>T(s.target.value),children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"user",children:"Users"}),e.jsx("option",{value:"admin",children:"Admins"}),e.jsx("option",{value:"super_admin",children:"Super Admins"})]})}),e.jsx("button",{className:"btn btn-primary",onClick:x,children:"Refresh"})]}),e.jsxs("div",{className:"users-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:c.length}),e.jsx("p",{children:"Total Users"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:c.filter(s=>s.role==="super_admin").length}),e.jsx("p",{children:"Super Admins"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:c.filter(s=>s.role==="admin").length}),e.jsx("p",{children:"Admins"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:c.filter(s=>s.enrolled_programs&&s.enrolled_programs.length>0).length}),e.jsx("p",{children:"With Course Access"})]})]}),M?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading users..."})]}):e.jsx("div",{className:"users-table-container",children:e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Enrolled Courses"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:k.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"no-users",children:"No users found"})}):k.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.name||"N/A"}),e.jsx("td",{children:s.email}),e.jsx("td",{children:e.jsx("span",{className:`role-badge ${s.role||"user"}`,children:s.role==="super_admin"?"Super Admin":s.role==="admin"?"Admin":"User"})}),e.jsx("td",{children:s.role==="admin"||s.role==="super_admin"?e.jsx("span",{className:"access-badge active",children:"All Access (Admin)"}):s.enrolled_programs&&s.enrolled_programs.length>0?e.jsx("div",{className:"enrolled-courses-list",children:s.enrolled_programs.map(a=>{const n=g.find(o=>o.id===a);return e.jsx("span",{className:"course-badge",children:n?n.title:"Unknown Course"},a)})}):e.jsx("span",{className:"text-muted",children:"No Access"})}),e.jsx("td",{children:s.createdAt?.toLocaleDateString()||"N/A"}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn-icon edit",onClick:()=>q(s),title:"Edit User",disabled:s.role==="super_admin",children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",width:"16",height:"16",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.jsx("button",{className:"btn-icon delete",onClick:()=>O(s),title:"Delete User",disabled:s.id===C.currentUser?.uid||s.role==="super_admin",children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",width:"16",height:"16",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},s.id))})]})})]})]})};export{de as default};

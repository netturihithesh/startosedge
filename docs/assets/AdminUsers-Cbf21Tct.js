import{u as G,p as J,r as a,g as K,d as A,b as p,a as C,t as Q,v as X,j as e,C as Z,x as I}from"./index-C3Bzpec5.js";import{s as ee}from"./supabaseClient-Cjyym_43.js";import{u as se,T as re}from"./Toast-BY1bX9md.js";import{M as le}from"./Modal-iBd9dXy1.js";/* empty css              */const de=()=>{const y=G(),{isAdmin:d,loading:j}=J(),{toasts:E,success:S,error:i,removeToast:k}=se(),[c,D]=a.useState([]),[g,M]=a.useState([]),[R,U]=a.useState(!0),[f,L]=a.useState(""),[v,T]=a.useState("all"),[r,m]=a.useState(null),[F,u]=a.useState(!1),[z,h]=a.useState(!1),[t,b]=a.useState({role:"",enrolled_programs:[]}),[_,P]=a.useState("user");a.useEffect(()=>{!j&&!d&&(i("Access denied. Admin privileges required."),y("/"))},[d,j,y]),a.useEffect(()=>{d&&(x(),B(),$())},[d]);const $=async()=>{try{const s=await K(A(p,"users",C.currentUser.uid));s.exists()&&P(s.data().role||"user")}catch(s){console.error("Error fetching current user role:",s)}},B=async()=>{try{const{data:s,error:l}=await ee.from("programs").select("id, title");if(l)throw l;M(s||[])}catch(s){console.error("Error fetching programs:",s),i("Failed to fetch programs list.")}},x=async()=>{U(!0);try{const s=Q(p,"users"),n=(await X(s)).docs.map(o=>({id:o.id,...o.data(),createdAt:o.data().createdAt?.toDate?.()||new Date,enrolled_programs:o.data().enrolled_programs||[]}));n.sort((o,Y)=>Y.createdAt-o.createdAt),D(n)}catch(s){console.error("Error fetching users:",s),i("Failed to fetch users.")}finally{U(!1)}},V=async()=>{if(r)try{if(r.id===C.currentUser?.uid){i("You cannot delete your own account from here."),u(!1);return}await Z(A(p,"users",r.id)),S(`User ${r.name||r.email} has been deleted.`),u(!1),m(null),x()}catch(s){console.error("Error deleting user:",s),i("Failed to delete user.")}},H=async()=>{if(r){if(t.role!==r.role&&_!=="super_admin"){i("Only Super Admins can change user roles.");return}try{const s=A(p,"users",r.id);await I(s,{role:t.role,enrolled_programs:t.enrolled_programs,hasAccess:t.enrolled_programs.length>0}),S(`User ${r.name||r.email} has been updated.`),h(!1),m(null),x()}catch(s){console.error("Error updating user:",s),i("Failed to update user.")}}},W=s=>{m(s),b({role:s.role||"user",enrolled_programs:s.enrolled_programs||[]}),h(!0)},q=s=>{m(s),u(!0)},O=s=>{b(l=>{const n=l.enrolled_programs;return n.includes(s)?{...l,enrolled_programs:n.filter(o=>o!==s)}:{...l,enrolled_programs:[...n,s]}})},w=c.filter(s=>{const l=s.name?.toLowerCase().includes(f.toLowerCase())||s.email?.toLowerCase().includes(f.toLowerCase()),n=v==="all"||s.role===v;return l&&n});if(j)return e.jsx("div",{className:"admin-users-page",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading..."})]})});if(!d)return null;const N=_==="super_admin";return e.jsxs("div",{className:"admin-users-page",children:[E.map(s=>e.jsx(re,{message:s.message,type:s.type,onClose:()=>k(s.id)},s.id)),F&&e.jsx(le,{title:"Delete User",message:`Are you sure you want to delete ${r?.name||r?.email}? This action cannot be undone.`,onConfirm:V,onCancel:()=>u(!1),confirmText:"Delete",type:"confirm"}),z&&e.jsx("div",{className:"modal-overlay",onClick:()=>h(!1),children:e.jsxs("div",{className:"modal-content edit-user-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Edit User"}),e.jsx("button",{className:"modal-close",onClick:()=>h(!1),children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{className:"form-group",children:e.jsxs("label",{children:["User: ",r?.name||r?.email]})}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"role",children:["Role ",!N&&e.jsx("span",{style:{color:"#ff6b6b",fontSize:"0.85em"},children:"(Super Admin only)"})]}),e.jsxs("select",{id:"role",value:t.role,onChange:s=>b({...t,role:s.target.value}),disabled:!N,children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Course Access"}),t.role==="admin"||t.role==="super_admin"?e.jsxs("div",{className:"alert-info",style:{padding:"10px",background:"rgba(99, 102, 241, 0.1)",borderRadius:"8px",border:"1px solid rgba(99, 102, 241, 0.2)",color:"#a5b4fc"},children:[e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",width:"16",height:"16",style:{marginRight:"8px",verticalAlign:"middle"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})," ",e.jsx("strong",{children:t.role==="super_admin"?"Super Admins":"Admins"})," automatically have access to all courses."]}):e.jsx("div",{className:"course-checkbox-list",children:g.length===0?e.jsx("p",{className:"text-muted",children:"No programs available."}):g.map(s=>e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:t.enrolled_programs.includes(s.id),onChange:()=>O(s.id)}),e.jsx("span",{children:s.title})]},s.id))})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>h(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:H,children:"Save Changes"})]})]})}),e.jsxs("div",{className:"admin-users-container",children:[e.jsxs("div",{className:"admin-users-header",children:[e.jsx("h1",{children:"User Management"}),e.jsxs("p",{children:["Manage all users, their roles, and access permissions",N?" (Super Admin)":" (Admin)"]})]}),e.jsxs("div",{className:"admin-controls",children:[e.jsx("div",{className:"search-box",children:e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:f,onChange:s=>L(s.target.value)})}),e.jsx("div",{className:"filter-box",children:e.jsxs("select",{value:v,onChange:s=>T(s.target.value),children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"user",children:"Users"}),e.jsx("option",{value:"admin",children:"Admins"}),e.jsx("option",{value:"super_admin",children:"Super Admins"})]})}),e.jsx("button",{className:"btn btn-primary",onClick:x,children:"Refresh"})]}),e.jsxs("div",{className:"users-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:c.length}),e.jsx("p",{children:"Total Users"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:c.filter(s=>s.role==="super_admin").length}),e.jsx("p",{children:"Super Admins"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:c.filter(s=>s.role==="admin").length}),e.jsx("p",{children:"Admins"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:c.filter(s=>s.enrolled_programs&&s.enrolled_programs.length>0).length}),e.jsx("p",{children:"With Course Access"})]})]}),R?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading users..."})]}):e.jsx("div",{className:"users-table-container",children:e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Enrolled Courses"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"no-users",children:"No users found"})}):w.map(s=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Name",children:s.name||"N/A"}),e.jsx("td",{"data-label":"Email",children:s.email}),e.jsx("td",{"data-label":"Role",children:e.jsx("span",{className:`role-badge ${s.role||"user"}`,children:s.role==="super_admin"?"Super Admin":s.role==="admin"?"Admin":"User"})}),e.jsx("td",{"data-label":"Enrolled Courses",children:s.role==="admin"||s.role==="super_admin"?e.jsx("span",{className:"access-badge active",children:"All Access (Admin)"}):s.enrolled_programs&&s.enrolled_programs.length>0?e.jsx("div",{className:"enrolled-courses-list",children:s.enrolled_programs.map(l=>{const n=g.find(o=>o.id===l);return e.jsx("span",{className:"course-badge",children:n?n.title:"Unknown Course"},l)})}):e.jsx("span",{className:"text-muted",children:"No Access"})}),e.jsx("td",{"data-label":"Created",children:s.createdAt?.toLocaleDateString()||"N/A"}),e.jsx("td",{"data-label":"Actions",children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn-icon edit",onClick:()=>W(s),title:"Edit User",disabled:s.role==="super_admin",children:e.jsx("svg",{fill:"currentColor",viewBox:"0 0 24 24",width:"18",height:"18",children:e.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"})})}),e.jsx("button",{className:"btn-icon delete",onClick:()=>q(s),title:"Delete User",disabled:s.id===C.currentUser?.uid||s.role==="super_admin",children:e.jsx("svg",{fill:"currentColor",viewBox:"0 0 24 24",width:"18",height:"18",children:e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})})})]})})]},s.id))})]})})]})]})};export{de as default};

import{u as re,r as i,n as ae,a as ne,g as ie,d as oe,b as M,j as e,q as le,o as ce,w as de,p as ue,t as me,v as he}from"./index-D9lLUq2j.js";import{s as c}from"./supabaseClient-14wf3DVT.js";import{u as pe,T as ge}from"./Toast-la1i9ja7.js";/* empty css              */const ve=()=>{const f=re(),[x,P]=i.useState("all"),[_,U]=i.useState([]),{isAdmin:b}=ae(),{toasts:W,success:h,error:o,removeToast:B}=pe(),[I,H]=i.useState(!0),[q,L]=i.useState(!1),[G,D]=i.useState([]),[m,z]=i.useState(null),[j,F]=i.useState(""),[N,$]=i.useState(""),[a,w]=i.useState({title:"",description:"",duration:"",price:"",category:"technical",thumbnail_url:"",is_featured:!1}),[S,p]=i.useState(!1),[E,v]=i.useState(!1),[y,T]=i.useState(null),[O,K]=i.useState(!0);i.useEffect(()=>{const t=ne.onAuthStateChanged(async s=>{if(!s)o("Please log in to view programs."),f("/login");else{try{const r=await ie(oe(M,"users",s.uid));if(r.exists()){const l=r.data();z(l),D(l.enrolled_programs||[])}}catch(r){console.error("Error fetching user profile:",r)}K(!1),C()}});return()=>t()},[f,o]),i.useEffect(()=>(S||E?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[S,E]);const C=async()=>{try{const{data:t,error:s}=await c.from("programs").select("*").order("created_at",{ascending:!1});if(s)throw s;U(t||[])}catch(t){console.error("Error loading programs:",t)}finally{H(!1)}},g=t=>{const s=t.target.type==="checkbox"?t.target.checked:t.target.value;w({...a,[t.target.name]:s})},V=t=>{const s=t.target.files[0];if(s){if(!s.type.startsWith("image/")){o("Please select an image file");return}if(s.size>2*1024*1024){o("Image size should be less than 2MB");return}T(s)}},J=async t=>{const s=t.name.split(".").pop(),r=`${Date.now()}_${Math.random().toString(36).substring(7)}.${s}`,{data:l,error:d}=await c.storage.from("course-videos").upload(r,t,{cacheControl:"3600",upsert:!1});if(d)throw new Error("Image upload failed: "+d.message);const{data:{publicUrl:n}}=c.storage.from("course-videos").getPublicUrl(r);return n},[k,A]=i.useState(null),Q=async t=>{t.preventDefault(),L(!0);try{let s=a.thumbnail_url;if(y&&(s=await J(y)),k){const{error:r}=await c.from("programs").update({title:a.title,description:a.description,duration:a.duration,price:a.price,category:a.category,thumbnail_url:s,is_featured:a.is_featured}).eq("id",k.id);if(r)throw r;h("Program updated successfully!")}else{const{error:r}=await c.from("programs").insert([{title:a.title,description:a.description,duration:a.duration,price:a.price,category:a.category,thumbnail_url:s,is_featured:a.is_featured}]);if(r)throw r;h("Program added successfully!")}w({title:"",description:"",duration:"",price:"",category:"technical",thumbnail_url:"",is_featured:!1}),T(null),A(null),p(!1),C()}catch(s){console.error("Error saving program:",s),o("Failed to save program: "+s.message)}finally{L(!1)}},X=t=>{A(t),w({title:t.title,description:t.description,duration:t.duration,price:t.price,category:t.category,thumbnail_url:t.thumbnail_url,is_featured:t.is_featured}),p(!0)},Y=()=>{A(null),w({title:"",description:"",duration:"",price:"",category:"technical",thumbnail_url:"",is_featured:!1}),T(null)},Z=async t=>{if(window.confirm(`âš ï¸ WARNING: This will PERMANENTLY delete the program, its thumbnail, and ALL associated videos from both the database and storage.

Are you sure you want to proceed?`))try{const s=document.activeElement;s&&(s.disabled=!0,s.innerText="Deleting...");const{data:r}=await c.from("programs").select("thumbnail_url").eq("id",t).single(),{data:l}=await c.from("program_videos").select("video_url").eq("program_id",t);if(r?.thumbnail_url&&r.thumbnail_url.includes("course-videos/")){const n=r.thumbnail_url.split("course-videos/").pop();if(n){const{error:u}=await c.storage.from("course-videos").remove([n]);u&&console.warn("Failed to delete thumbnail:",u)}}if(l&&l.length>0){const n=l.map(u=>!u.video_url||!u.video_url.includes("course-videos/")?null:u.video_url.split("course-videos/").pop()).filter(Boolean);if(n.length>0){const{error:u}=await c.storage.from("course-videos").remove(n);u&&console.warn("Failed to delete videos:",u)}}const{error:d}=await c.from("programs").delete().eq("id",t);if(d)throw d;h("Program and all associated files deleted successfully!"),C()}catch(s){console.error("Error deleting program:",s),o("Failed to delete program: "+s.message);const r=document.activeElement;r&&(r.disabled=!1,r.innerText="Delete")}},ee=async t=>{try{const{error:s}=await c.from("programs").update({is_featured:!t.is_featured}).eq("id",t.id);if(s)throw s;h(`Program ${t.is_featured?"removed from Home Page":"added to Home Page"}`),C()}catch(s){console.error("Error updating program:",s),o("Failed to update program")}},te=async t=>{if(t.preventDefault(),!j||!N){o("Please enter email and select a program.");return}try{const s=le(ce(M,"users"),de("email","==",j)),r=await ue(s);if(r.empty){o("User not found! Ask them to sign up first.");return}const l=r.docs[0];await me(l.ref,{enrolled_programs:he(N)}),h(`âœ… Access granted to ${j}!`),F(""),$(""),v(!1),j===m.email&&D(d=>[...d,N])}catch(s){console.error("Error granting access:",s),o("Failed to grant access: "+s.message)}},se=async t=>{if(!m){o("Please update your profile first (Name & Phone required)."),f("/profile");return}if(!m.phone){o("Phone number is required for purchase. Please update your profile."),f("/profile");return}if(!window.confirm(`Confirm purchase request for "${t.title}"? Admin will contact you at ${m.phone}.`))return;const s=`buy-btn-${t.id}`,r=document.getElementById(s),l=r?r.innerText:"ðŸ›’ Buy Now";r&&(r.innerText="â³ Sending...",r.disabled=!0);const d="https://script.google.com/macros/s/AKfycbx3jlCg-oOWDhDaP258SUUDrtbqC6h1kf4WQXqf7s-K-ROj4ZH-hioneCoHfWudMJhT/exec";try{const n=new URLSearchParams;n.append("name",m.name),n.append("email",m.email),n.append("phone",m.phone),n.append("course",t.title),n.append("timestamp",new Date().toLocaleString()),await fetch(d,{method:"POST",body:n,mode:"no-cors",headers:{"Content-Type":"application/x-www-form-urlencoded"}}),h("Request sent successfully! Admin will verify and grant access shortly.")}catch(n){console.error("Error sending request:",n),o("Failed to send request. Please try again or contact support.")}finally{r&&(r.innerText="âœ… Request Sent",setTimeout(()=>{r.innerText=l,r.disabled=!1},3e3))}},R=x==="all"?_:_.filter(t=>t.category===x);return O?e.jsx("div",{className:"flex-center",style:{height:"100vh"},children:"Loading..."}):e.jsxs("div",{className:"programs-detail-page",children:[W.map(t=>e.jsx(ge,{message:t.message,type:t.type,onClose:()=>B(t.id)},t.id)),e.jsx("section",{className:"programs-detail-hero section",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"programs-detail-hero-content text-center",children:[e.jsxs("h1",{className:"fade-in-up",children:["All Career ",e.jsx("span",{className:"text-gradient",children:"Programs"})]}),e.jsx("p",{className:"hero-description fade-in-up",children:"Choose your path to a successful tech career. Every program is designed to make you industry-ready."})]})})}),b&&e.jsx("section",{className:"section pb-0",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"admin-controls-bar",style:{display:"flex",gap:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("button",{className:"btn btn-primary",onClick:()=>{Y(),p(!0)},children:[e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",width:"20",height:"20",style:{marginRight:"8px"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add New Program"]}),e.jsxs("button",{className:"btn btn-success",onClick:()=>v(!0),children:[e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",width:"20",height:"20",style:{marginRight:"8px"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})}),"Grant Access"]})]})})}),S&&e.jsx("div",{className:"modal-overlay",onClick:()=>p(!1),children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"800px",width:"90%"},onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:k?"Edit Program":"Add New Program"}),e.jsx("button",{className:"modal-close",onClick:()=>p(!1),children:"Ã—"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{onSubmit:Q,className:"admin-form",children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Program Title"}),e.jsx("input",{name:"title",value:a.title,onChange:g,required:!0,placeholder:"e.g. Full Stack Development"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Price"}),e.jsx("input",{name:"price",value:a.price,onChange:g,required:!0,placeholder:"e.g. â‚¹20,000"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Duration"}),e.jsx("input",{name:"duration",value:a.duration,onChange:g,required:!0,placeholder:"e.g. 6 Months"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category"}),e.jsxs("select",{name:"category",value:a.category,onChange:g,children:[e.jsx("option",{value:"technical",children:"Technical"}),e.jsx("option",{value:"non-technical",children:"Non-Technical"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Thumbnail Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:V}),y&&e.jsxs("small",{className:"text-muted",children:["Selected: ",y.name]}),!y&&a.thumbnail_url&&e.jsxs("small",{className:"text-muted",children:["Current: ",e.jsx("a",{href:a.thumbnail_url,target:"_blank",rel:"noreferrer",children:"View Image"})]})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"is_featured",checked:a.is_featured,onChange:g}),"Feature on Home Page"]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{name:"description",value:a.description,onChange:g,required:!0,rows:"3",placeholder:"Describe the program..."})]}),e.jsxs("div",{className:"admin-form-actions",style:{marginTop:"1rem",display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>p(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:q,children:q?"Saving...":k?"Update Program":"Add Program"})]})]})})]})}),E&&e.jsx("div",{className:"modal-overlay",onClick:()=>v(!1),children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"500px",width:"90%"},onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Grant Course Access"}),e.jsx("button",{className:"modal-close",onClick:()=>v(!1),children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("p",{className:"text-muted",style:{marginBottom:"1rem"},children:"Enter the user's email to unlock the course for them."}),e.jsxs("form",{onSubmit:te,className:"admin-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"User Email"}),e.jsx("input",{type:"email",value:j,onChange:t=>F(t.target.value),required:!0,placeholder:"user@example.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Program"}),e.jsxs("select",{value:N,onChange:t=>$(t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Course --"}),_.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{className:"admin-form-actions",style:{marginTop:"1rem",display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>v(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-success",children:"Grant Access"})]})]})]})]})}),e.jsx("section",{className:"filter-section section",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"filter-buttons",children:[e.jsx("button",{className:`filter-btn ${x==="all"?"active":""}`,onClick:()=>P("all"),children:"All"}),e.jsx("button",{className:`filter-btn ${x==="technical"?"active":""}`,onClick:()=>P("technical"),children:"Technical"}),e.jsx("button",{className:`filter-btn ${x==="non-technical"?"active":""}`,onClick:()=>P("non-technical"),children:"Non-Technical"})]})})}),e.jsx("section",{className:"programs-grid-section section",children:e.jsx("div",{className:"container",children:I?e.jsx("p",{className:"text-center",children:"Loading programs..."}):R.length===0?e.jsx("p",{className:"text-center text-muted",children:"No programs found."}):e.jsx("div",{className:"programs-detail-grid",children:R.map(t=>{const s=G.includes(t.id)||b;return e.jsxs("div",{className:`program-detail-card card ${b?"admin-mode":""}`,children:[e.jsxs("div",{className:"program-thumbnail",children:[e.jsx("img",{src:t.thumbnail_url||"https://via.placeholder.com/300x200?text=No+Image",alt:t.title,onError:r=>{r.target.src="https://via.placeholder.com/300x200?text=No+Image"}}),t.is_featured&&e.jsx("span",{className:"featured-badge",children:"Featured"}),e.jsx("span",{className:"category-badge",children:t.category}),b&&e.jsx("button",{className:"edit-btn-pencil",title:"Edit Program",onClick:r=>{r.stopPropagation(),X(t)},children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",width:"16",height:"16",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})})]}),e.jsxs("div",{className:"program-content",children:[e.jsx("h3",{children:t.title}),e.jsx("p",{className:"program-description",children:t.description}),e.jsxs("div",{className:"program-meta",children:[e.jsxs("span",{children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{marginRight:"6px"},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]}),t.duration]}),e.jsxs("span",{children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{marginRight:"6px"},children:[e.jsx("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"}),e.jsx("line",{x1:"7",y1:"7",x2:"7.01",y2:"7"})]}),t.price]})]}),s?e.jsx("button",{className:"btn btn-success",onClick:()=>f(`/programs/${t.id}`),children:"Access Course"}):e.jsx("button",{id:`buy-btn-${t.id}`,className:"btn btn-primary",onClick:()=>se(t),children:"Buy Now"}),b&&e.jsxs("div",{className:"admin-controls",children:[e.jsx("button",{className:`btn btn-sm ${t.is_featured?"btn-warning":"btn-success"}`,onClick:r=>{r.stopPropagation(),ee(t)},children:t.is_featured?"Un-Feature":"Feature"}),e.jsx("button",{className:"btn btn-danger btn-sm",onClick:r=>{r.stopPropagation(),Z(t.id)},children:"Delete"})]})]})]},t.id)})})})})]})};export{ve as default};

import{u as Z,r as i,n as Y,a as ee,f as te,h as re,i as A,j as e,q as se,o as ae,w as ne,p as ie,t as oe,v as le}from"./index-4wgqcQiA.js";import{s as d}from"./supabaseClient-DMpEeBZF.js";import{u as ce,T as de}from"./Toast-DvUYWCiD.js";const pe=()=>{const p=Z(),[g,w]=i.useState("all"),[P,L]=i.useState([]),{isAdmin:f}=Y(),{toasts:F,success:u,error:n,removeToast:$}=ce(),[U,I]=i.useState(!0),[_,S]=i.useState(!1),[R,E]=i.useState([]),[l,B]=i.useState(null),[x,T]=i.useState(""),[y,q]=i.useState(""),[a,v]=i.useState({title:"",description:"",duration:"",price:"",category:"technical",thumbnail_url:"",is_featured:!1}),[j,C]=i.useState(null),[W,G]=i.useState(!0);i.useEffect(()=>{const t=ee.onAuthStateChanged(async r=>{if(!r)n("Please log in to view programs."),p("/login");else{try{const s=await te(re(A,"users",r.uid));if(s.exists()){const c=s.data();B(c),E(c.enrolled_programs||[])}}catch(s){console.error("Error fetching user profile:",s)}G(!1),N()}});return()=>t()},[p,n]);const N=async()=>{try{const{data:t,error:r}=await d.from("programs").select("*").order("created_at",{ascending:!1});if(r)throw r;L(t||[])}catch(t){console.error("Error loading programs:",t)}finally{I(!1)}},m=t=>{const r=t.target.type==="checkbox"?t.target.checked:t.target.value;v({...a,[t.target.name]:r})},H=t=>{const r=t.target.files[0];if(r){if(!r.type.startsWith("image/")){n("Please select an image file");return}if(r.size>2*1024*1024){n("Image size should be less than 2MB");return}C(r)}},M=async t=>{const r=t.name.split(".").pop(),s=`${Date.now()}_${Math.random().toString(36).substring(7)}.${r}`,{data:c,error:h}=await d.storage.from("course-videos").upload(s,t,{cacheControl:"3600",upsert:!1});if(h)throw new Error("Image upload failed: "+h.message);const{data:{publicUrl:o}}=d.storage.from("course-videos").getPublicUrl(s);return o},[b,k]=i.useState(null),z=async t=>{t.preventDefault(),S(!0);try{let r=a.thumbnail_url;if(j&&(r=await M(j)),b){const{error:s}=await d.from("programs").update({title:a.title,description:a.description,duration:a.duration,price:a.price,category:a.category,thumbnail_url:r,is_featured:a.is_featured}).eq("id",b.id);if(s)throw s;u("Program updated successfully!")}else{const{error:s}=await d.from("programs").insert([{title:a.title,description:a.description,duration:a.duration,price:a.price,category:a.category,thumbnail_url:r,is_featured:a.is_featured}]);if(s)throw s;u("Program added successfully!")}v({title:"",description:"",duration:"",price:"",category:"technical",thumbnail_url:"",is_featured:!1}),C(null),k(null),N()}catch(r){console.error("Error saving program:",r),n("Failed to save program: "+r.message)}finally{S(!1)}},O=t=>{k(t),v({title:t.title,description:t.description,duration:t.duration,price:t.price,category:t.category,thumbnail_url:t.thumbnail_url,is_featured:t.is_featured}),window.scrollTo({top:0,behavior:"smooth"})},K=()=>{k(null),v({title:"",description:"",duration:"",price:"",category:"technical",thumbnail_url:"",is_featured:!1}),C(null)},V=async t=>{if(window.confirm("Delete this program?"))try{const{error:r}=await d.from("programs").delete().eq("id",t);if(r)throw r;u("Program deleted"),N()}catch(r){console.error("Error deleting program:",r),n("Failed to delete program")}},J=async t=>{try{const{error:r}=await d.from("programs").update({is_featured:!t.is_featured}).eq("id",t.id);if(r)throw r;u(`Program ${t.is_featured?"removed from Home Page":"added to Home Page"}`),N()}catch(r){console.error("Error updating program:",r),n("Failed to update program")}},Q=async t=>{if(t.preventDefault(),!x||!y){n("Please enter email and select a program.");return}try{const r=se(ae(A,"users"),ne("email","==",x)),s=await ie(r);if(s.empty){n("User not found! Ask them to sign up first.");return}const c=s.docs[0];await oe(c.ref,{enrolled_programs:le(y)}),u(`âœ… Access granted to ${x}!`),T(""),q(""),x===l.email&&E(h=>[...h,y])}catch(r){console.error("Error granting access:",r),n("Failed to grant access: "+r.message)}},X=async t=>{if(!l){n("Please update your profile first (Name & Phone required)."),p("/profile");return}if(!l.phone){n("Phone number is required for purchase. Please update your profile."),p("/profile");return}if(!window.confirm(`Confirm purchase request for "${t.title}"? Admin will contact you at ${l.phone}.`))return;const r=`buy-btn-${t.id}`,s=document.getElementById(r),c=s?s.innerText:"ðŸ›’ Buy Now";s&&(s.innerText="â³ Sending...",s.disabled=!0);const h="https://script.google.com/macros/s/AKfycbx3jlCg-oOWDhDaP258SUUDrtbqC6h1kf4WQXqf7s-K-ROj4ZH-hioneCoHfWudMJhT/exec";try{const o=new URLSearchParams;o.append("name",l.name),o.append("email",l.email),o.append("phone",l.phone),o.append("course",t.title),o.append("timestamp",new Date().toLocaleString()),await fetch(h,{method:"POST",body:o,mode:"no-cors",headers:{"Content-Type":"application/x-www-form-urlencoded"}}),u("Request sent successfully! Admin will verify and grant access shortly.")}catch(o){console.error("Error sending request:",o),n("Failed to send request. Please try again or contact support.")}finally{s&&(s.innerText="âœ… Request Sent",setTimeout(()=>{s.innerText=c,s.disabled=!1},3e3))}},D=g==="all"?P:P.filter(t=>t.category===g);return W?e.jsx("div",{className:"flex-center",style:{height:"100vh"},children:"Loading..."}):e.jsxs("div",{className:"programs-detail-page",children:[F.map(t=>e.jsx(de,{message:t.message,type:t.type,onClose:()=>$(t.id)},t.id)),e.jsx("section",{className:"programs-detail-hero section",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"programs-detail-hero-content text-center",children:[e.jsxs("h1",{className:"fade-in-up",children:["All Career ",e.jsx("span",{className:"text-gradient",children:"Programs"})]}),e.jsx("p",{className:"hero-description fade-in-up",children:"Choose your path to a successful tech career. Every program is designed to make you industry-ready."})]})})}),f&&e.jsx("section",{className:"section",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"admin-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"2rem"},children:[e.jsxs("div",{className:"admin-panel card",children:[e.jsx("h3",{children:b?"Edit Program":"Add New Program"}),e.jsxs("form",{onSubmit:z,className:"admin-form",children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Program Title"}),e.jsx("input",{name:"title",value:a.title,onChange:m,required:!0,placeholder:"e.g. Full Stack Development"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Price"}),e.jsx("input",{name:"price",value:a.price,onChange:m,required:!0,placeholder:"e.g. â‚¹20,000"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Duration"}),e.jsx("input",{name:"duration",value:a.duration,onChange:m,required:!0,placeholder:"e.g. 6 Months"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category"}),e.jsxs("select",{name:"category",value:a.category,onChange:m,children:[e.jsx("option",{value:"technical",children:"Technical"}),e.jsx("option",{value:"non-technical",children:"Non-Technical"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Thumbnail Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:H}),j&&e.jsxs("small",{className:"text-muted",children:["Selected: ",j.name]}),!j&&a.thumbnail_url&&e.jsxs("small",{className:"text-muted",children:["Current: ",e.jsx("a",{href:a.thumbnail_url,target:"_blank",rel:"noreferrer",children:"View Image"})]})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"is_featured",checked:a.is_featured,onChange:m}),"Feature on Home Page"]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{name:"description",value:a.description,onChange:m,required:!0,rows:"3",placeholder:"Describe the program..."})]}),e.jsxs("div",{className:"admin-form-actions",children:[e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:_,children:_?"Saving...":b?"Update Program":"Add Program"}),b&&e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:K,children:"Cancel"})]})]})]}),e.jsxs("div",{className:"admin-panel card",style:{height:"fit-content"},children:[e.jsx("h3",{children:"Grant Course Access"}),e.jsx("p",{className:"text-muted",style:{marginBottom:"1rem"},children:"Enter the user's email from the Google Sheet to unlock the course for them."}),e.jsxs("form",{onSubmit:Q,className:"admin-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"User Email"}),e.jsx("input",{type:"email",value:x,onChange:t=>T(t.target.value),required:!0,placeholder:"user@example.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Program"}),e.jsxs("select",{value:y,onChange:t=>q(t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Course --"}),P.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsx("button",{type:"submit",className:"btn btn-success",children:"Grant Access"})]})]})]})})}),e.jsx("section",{className:"filter-section section",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"filter-buttons",children:[e.jsx("button",{className:`filter-btn ${g==="all"?"active":""}`,onClick:()=>w("all"),children:"All"}),e.jsx("button",{className:`filter-btn ${g==="technical"?"active":""}`,onClick:()=>w("technical"),children:"Technical"}),e.jsx("button",{className:`filter-btn ${g==="non-technical"?"active":""}`,onClick:()=>w("non-technical"),children:"Non-Technical"})]})})}),e.jsx("section",{className:"programs-grid-section section",children:e.jsx("div",{className:"container",children:U?e.jsx("p",{className:"text-center",children:"Loading programs..."}):D.length===0?e.jsx("p",{className:"text-center text-muted",children:"No programs found."}):e.jsx("div",{className:"programs-detail-grid",children:D.map(t=>{const r=R.includes(t.id)||f;return e.jsxs("div",{className:`program-detail-card card ${f?"admin-mode":""}`,children:[e.jsxs("div",{className:"program-thumbnail",children:[e.jsx("img",{src:t.thumbnail_url||"https://via.placeholder.com/300x200?text=No+Image",alt:t.title,onError:s=>{s.target.src="https://via.placeholder.com/300x200?text=No+Image"}}),t.is_featured&&e.jsx("span",{className:"featured-badge",children:"Featured"}),e.jsx("span",{className:"category-badge",children:t.category}),f&&e.jsx("button",{className:"edit-btn-pencil",title:"Edit Program",onClick:s=>{s.stopPropagation(),O(t)},children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",width:"16",height:"16",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})})]}),e.jsxs("div",{className:"program-content",children:[e.jsx("h3",{children:t.title}),e.jsx("p",{className:"program-description",children:t.description}),e.jsxs("div",{className:"program-meta",children:[e.jsxs("span",{children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{marginRight:"6px"},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]}),t.duration]}),e.jsxs("span",{children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{marginRight:"6px"},children:[e.jsx("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"}),e.jsx("line",{x1:"7",y1:"7",x2:"7.01",y2:"7"})]}),t.price]})]}),r?e.jsx("button",{className:"btn btn-success",onClick:()=>p(`/programs/${t.id}`),children:"Access Course"}):e.jsx("button",{id:`buy-btn-${t.id}`,className:"btn btn-primary",onClick:()=>X(t),children:"Buy Now"}),f&&e.jsxs("div",{className:"admin-controls",children:[e.jsx("button",{className:`btn btn-sm ${t.is_featured?"btn-warning":"btn-success"}`,onClick:s=>{s.stopPropagation(),J(t)},children:t.is_featured?"Un-Feature":"Feature"}),e.jsx("button",{className:"btn btn-danger btn-sm",onClick:s=>{s.stopPropagation(),V(t.id)},children:"Delete"})]})]})]},t.id)})})})})]})};export{pe as default};
